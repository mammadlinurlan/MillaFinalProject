@model ShopVM

<nav aria-label="breadcrumb" class="breadcrumb-nav border-0 mb-0">
    <div class="container d-flex align-items-center">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-controller="man" asp-action="index">Man</a></li>

            <li class="breadcrumb-item"><a asp-controller="man" asp-action="shop" asp-route-id="@Model.ProductSizeColor.Product.CategoryId">@Model.ProductSizeColor.Product.Category.Name</a></li>

        </ol>


    </div>
</nav>
<div class="page-content">
    <div class="container">
        <div class="product-details-top">
            @await Html.PartialAsync("_productDetailPartialView", Model)

        </div>

        <div class="product-details-tab">
            <ul class="nav nav-pills justify-content-center" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" id="product-desc-link" data-toggle="tab" href="#product-desc-tab" role="tab" aria-controls="product-desc-tab" aria-selected="true">Description</a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" id="product-shipping-link" data-toggle="tab" href="#product-shipping-tab" role="tab" aria-controls="product-shipping-tab" aria-selected="false">Shipping & Returns</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="product-review-link" data-toggle="tab" href="#product-review-tab" role="tab" aria-controls="product-review-tab" aria-selected="false">Reviews (2)</a>
                </li>
            </ul>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="product-desc-tab" role="tabpanel" aria-labelledby="product-desc-link">
                    <div class="product-desc-content">
                        @Model.ProductSizeColor.Product.Description
                    </div>
                </div>
                <div class="tab-pane fade" id="product-shipping-tab" role="tabpanel" aria-labelledby="product-shipping-link">
                    <div class="product-desc-content">
                        <h3>Delivery & returns</h3>
                        <p>
                            We deliver to over 100 countries around the world. For full details of the delivery options we offer, please view our <a href="#">Delivery information</a><br>
                            We hope you’ll love every purchase, but if you ever need to return an item you can do so within a month of receipt. For full details of how to make a return, please view our <a href="#">Returns information</a>
                        </p>
                    </div><!-- End .product-desc-content -->
                </div><!-- .End .tab-pane -->
                <div class="tab-pane fade" id="product-review-tab" role="tabpanel" aria-labelledby="product-review-link">
                    <div class="reviews">
                        <h3>Reviews (2)</h3>
                        <div class="review">
                            <div class="row no-gutters">
                                <div class="col-auto">
                                    <h4><a href="#">Samanta J.</a></h4>
                                    <div class="ratings-container">
                                        <div class="ratings">
                                            <div class="ratings-val" style="width: 80%;"></div><!-- End .ratings-val -->
                                        </div><!-- End .ratings -->
                                    </div><!-- End .rating-container -->
                                    <span class="review-date">6 days ago</span>
                                </div><!-- End .col -->
                                <div class="col">
                                    <h4>Good, perfect size</h4>

                                    <div class="review-content">
                                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ducimus cum dolores assumenda asperiores facilis porro reprehenderit animi culpa atque blanditiis commodi perspiciatis doloremque, possimus, explicabo, autem fugit beatae quae voluptas!</p>
                                    </div><!-- End .review-content -->

                                    <div class="review-action">
                                        <a href="#"><i class="icon-thumbs-up"></i>Helpful (2)</a>
                                        <a href="#"><i class="icon-thumbs-down"></i>Unhelpful (0)</a>
                                    </div><!-- End .review-action -->
                                </div><!-- End .col-auto -->
                            </div><!-- End .row -->
                        </div><!-- End .review -->

                        <div class="review">
                            <div class="row no-gutters">
                                <div class="col-auto">
                                    <h4><a href="#">John Doe</a></h4>
                                    <div class="ratings-container">
                                        <div class="ratings">
                                            <div class="ratings-val" style="width: 100%;"></div><!-- End .ratings-val -->
                                        </div><!-- End .ratings -->
                                    </div><!-- End .rating-container -->
                                    <span class="review-date">5 days ago</span>
                                </div><!-- End .col -->
                                <div class="col">
                                    <h4>Very good</h4>

                                    <div class="review-content">
                                        <p>Sed, molestias, tempore? Ex dolor esse iure hic veniam laborum blanditiis laudantium iste amet. Cum non voluptate eos enim, ab cumque nam, modi, quas iure illum repellendus, blanditiis perspiciatis beatae!</p>
                                    </div><!-- End .review-content -->

                                    <div class="review-action">
                                        <a href="#"><i class="icon-thumbs-up"></i>Helpful (0)</a>
                                        <a href="#"><i class="icon-thumbs-down"></i>Unhelpful (0)</a>
                                    </div><!-- End .review-action -->
                                </div><!-- End .col-auto -->
                            </div><!-- End .row -->
                        </div><!-- End .review -->
                    </div><!-- End .reviews -->
                </div><!-- .End .tab-pane -->
            </div><!-- End .tab-content -->
        </div>


        <h2 class="title text-center mb-4">You May Also Like</h2><!-- End .title text-center -->
        <div class="owl-carousel owl-simple carousel-equal-height carousel-with-shadow" data-toggle="owl"
             data-owl-options='{
                            "nav": false,
                            "dots": true,
                            "margin": 20,
                            "loop": false,
                            "responsive": {
                                "0": {
                                    "items":1
                                },
                                "480": {
                                    "items":2
                                },
                                "768": {
                                    "items":3
                                },
                                "992": {
                                    "items":4
                                },
                                "1200": {
                                    "items":4,
                                    "nav": true,
                                    "dots": false
                                }
                            }
                        }'>

            @foreach (var item in Model.ProductColors)
            {
                <div class="product product-7 text-center">
                    <figure class="product-media">
                        @if (item.Product.CreatedDate.AddDays(3) >= DateTime.Now)
                        {
                            <span class="product-label label-new">New</span>
                        }
                        <a class="until" asp-controller="man" asp-action="details" asp-route-id="@item.Product.ProductSizeColors.FirstOrDefault(p=>p.ProductId == item.ProductId && p.ColorId==item.ColorId).Id">
                            <img style="height:353px !important;object-fit:cover" src="~/assets/images/products/@item.Product.ProductSizeColors.FirstOrDefault(p=>p.ProductId == item.ProductId && p.ColorId == item.ColorId).MainImage" alt="Product image" class="product-image product-main">
                        </a>

                        <div class="product-action-vertical">
                            <a href="#" class="btn-product-icon btn-wishlist btn-expandable"><span>add to wishlist</span></a>
                            <a href="popup/quickView.html" class="btn-product-icon btn-quickview" title="Quick view"><span>Quick view</span></a>
                            <a href="#" class="btn-product-icon btn-compare" title="Compare"><span>Compare</span></a>
                        </div>

                        <div class="product-action">
                            <a href="#" class="btn-product btn-cart"><span>add to cart</span></a>
                        </div>
                    </figure>

                    <div class="product-body">

                        <h3 class="product-title"><a asp-controller="man" asp-action="details" asp-route-id="@item.Product.ProductSizeColors.FirstOrDefault(p=>p.ProductId == item.ProductId && p.ColorId==item.ColorId).Id">@item.Product.Name</a></h3>
                        <div class="product-price">

                            @if (item.Product.Discount != null && item.Product.Discount != 0)
                            {
                                <span class="new-price" style="color:orangered">@((item.Product.Price - (item.Product.Price * item.Product.Discount / 100) ) ) $ </span> <span class="old-price" style="text-decoration:line-through">was @item.Product.Price$</span>

                            }
                            else
                            {
                                <span style="color: #c96">@item.Product.Price $</span>
                            }
                        </div>


                        <div class="ratings-container">
                            <div class="ratings">
                                <div class="ratings-val" style="width: 20%;"></div>
                            </div>
                            <span class="ratings-text">( 2 Reviews )</span>
                        </div>


                        <div class="product-nav product-nav-thumbs">
                            <a asp-controller="man" asp-action="details" asp-route-id="@item.Product.ProductSizeColors.FirstOrDefault(p=>p.ProductId == item.ProductId && p.ColorId == item.ColorId).Id" class="active product-notMain">
                                <img class="nmSrc" style="height:52px;width:40px" src="~/assets/images/products/@item.Product.ProductSizeColors.FirstOrDefault(p=>p.ProductId == item.ProductId && p.ColorId == item.ColorId).MainImage" alt="product desc">
                            </a>


                            @foreach (var prd in item.Product.ProductColors.Where(p => p.ProductId == item.ProductId && p.ColorId != item.ColorId))
                            {


                                <a asp-controller="man" asp-action="details" asp-route-id="@item.Product.ProductSizeColors.FirstOrDefault(p=>p.ProductId == prd.ProductId && p.ColorId==prd.ColorId).Id" class="product-notMain">
                                    <img class="nmSrc" style="height:52px;width:40px" src="~/assets/images/products/@item.Product.ProductSizeColors.FirstOrDefault(p=>p.ProductId == prd.ProductId && p.ColorId == prd.ColorId).MainImage" alt="product desc">

                                </a>
                            }


                        </div>
                    </div>
                </div>




            }
        </div>



    </div>



</div>
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">

        <img id="changeForModal" style="object-fit:cover;width:575px;height:575px" src="~/assets/images/products/@Model.ProductSizeColor.MainImage" alt="product side">
    </div>
</div>



<!-- Modal -->
<div class="modal fade" id="modalSize" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
       <img src="https://9thson.com/wp-content/uploads/2020/08/Men_Round_Updated_with_5XL_2.jpg"/>
    </div>
</div>

@section Scripts{
    <script src="~/assets/js/jquery.elevateZoom.min.js"></script>
    <script>
        $(document).ready(function () {

            //$(".product-zoom").elevateZoom({
            //    zoomType: "inner",
            //    cursor: "crosshair"
            //});

            $(document).on("click", ".changeable", function (e) {
                e.preventDefault();
                let newSrc = $(this).children().attr("src")
                $(this).addClass("active");
                $(".changeable").not(this).removeClass("active")
                $(".product-zoom").attr("src", newSrc);
                $("#changeForModal").attr("src", newSrc)


                //let newimg = $(".product-zoom");
                //let newurl = window.location.origin;
                //let newsrc = $(newimg).attr("src");
                //let newlink = `${newurl}${newsrc}`

                //$(".product-zoom").removeAttr("data-zoom-image");

                //$(".product-zoom").elevateZoom({
                //    zoomType: "inner",
                //    cursor: "crosshair"
                //});
            })

            $(".product-notMain").click(function (e) {
                console.log("sa")
                e.preventDefault();
                var parent = $(this).closest(".product-body").prev().children(".until").children(".product-main")
                var newHref = $(this).attr("href")
                $(parent).closest(".until").removeAttr("href").attr("href", newHref)
                var closestNav = $(this).closest(".product-nav");
                $(closestNav.children(".product-notMain")).not(this).removeClass("active");

                $(this).addClass("active")
                var notmain = $(this).children(".nmSrc").attr("src")
                $(parent).attr("src", notmain)


            })

            $(document).on('click', ".noMainForColorChange", function (e) {

                e.preventDefault();
                var base = window.location.origin
                var href = $(this).children(".hiddenId").val()
                var link = `${base}/man/changecolor/${href}`
                console.log(link)

                fetch(link).then(res => res.text()).then(data => {

                    $(".product-zoom").elevateZoom({
                        zoomType: "inner",
                        cursor: "crosshair"
                    });
                    console.log('fetched')
                    $(".product-details-top").html('');
                    $(".product-details-top").html(data)
                    //$(".page-content").append(data)
                    var minus = `<i class="icon-minus"></i>`
                    var plus = `<i class="icon-plus"></i>`

                    $("input[type='number']").inputSpinner();
                    $("input[type='number']").next().addClass("input-spinner")
                    $("input[type='number']").next().children().last().children().removeClass("btn-outline-secondary").addClass("btn-spinner").empty().html(plus)
                    $("input[type='number']").next().children().first().children().removeClass("btn-outline-secondary").addClass("btn-spinner").empty().html(minus)

                })

            })
            //$(".noMainForColorChange").click(function (e) {


            //})

        })
    </script>


}
